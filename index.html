<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Neon Arena FPS</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: radial-gradient(circle at top, #111827 0%, #020617 60%, #000000 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: white;
    }

    #hud {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 16px;
      align-items: center;
      font-size: 14px;
      z-index: 10;
      text-shadow: 0 0 6px rgba(0,0,0,0.8);
      pointer-events: none;
    }

    .hud-pill {
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(56,189,248,0.6);
      backdrop-filter: blur(8px);
      pointer-events: auto;
    }

    #health-bar {
      width: 120px;
      height: 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      overflow: hidden;
      border: 1px solid rgba(248,113,113,0.8);
      display: inline-block;
      vertical-align: middle;
      margin-left: 6px;
    }

    #health-fill {
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg,#f97373,#fb7185);
      box-shadow: 0 0 8px rgba(248,113,113,0.9);
      transition: width 0.15s ease-out;
    }

    #status-text {
      font-size: 12px;
      opacity: 0.9;
    }

    .crosshair {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 9;
    }
    .crosshair::before,
    .crosshair::after {
      content: "";
      position: absolute;
      background: white;
      box-shadow: 0 0 4px cyan;
    }
    .crosshair::before {
      top: 9px;
      left: 0;
      width: 20px;
      height: 2px;
    }
    .crosshair::after {
      top: 0;
      left: 9px;
      width: 2px;
      height: 20px;
    }

    #overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(3,7,18,0.98));
      z-index: 20;
    }

    .panel {
      padding: 24px 28px;
      border-radius: 18px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(56,189,248,0.9);
      box-shadow: 0 20px 60px rgba(15,23,42,0.9);
      max-width: 360px;
      text-align: center;
    }

    .title {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 8px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      background: linear-gradient(90deg,#22d3ee,#38bdf8,#a855f7);
      -webkit-background-clip: text;
      color: transparent;
    }

    .subtitle {
      font-size: 13px;
      opacity: 0.85;
      margin-bottom: 18px;
    }

    .btn {
      display: inline-block;
      margin-top: 10px;
      padding: 10px 20px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      background: linear-gradient(90deg,#22c55e,#a3e635);
      color: #020617;
      box-shadow: 0 10px 30px rgba(34,197,94,0.4);
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(34,197,94,0.5);
    }

    .btn-secondary {
      background: transparent;
      color: #e5e7eb;
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow: none;
      margin-left: 8px;
    }

    .btn-secondary:hover {
      background: rgba(15,23,42,0.9);
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-top: 6px;
      opacity: 0.9;
    }

    #game-over-panel {
      display: none;
    }

    #powerup-banner {
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 13px;
      background: rgba(56,189,248,0.12);
      border: 1px solid rgba(56,189,248,0.8);
      backdrop-filter: blur(8px);
      text-shadow: 0 0 4px rgba(15,23,42,0.9);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease-out, transform 0.2s ease-out;
      z-index: 12;
    }

    #powerup-banner.show {
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }
  </style>
</head>
<body>
  <div id="hud">
    <div class="hud-pill">
      HP
      <div id="health-bar">
        <div id="health-fill"></div>
      </div>
    </div>
    <div class="hud-pill">Score: <span id="score-text">0</span></div>
    <div class="hud-pill">Wave: <span id="wave-text">1</span></div>
    <div id="status-text"></div>
  </div>

  <div id="crosshair" class="crosshair"></div>
  <div id="powerup-banner">Power-up!</div>

  <div id="overlay">
    <div id="start-panel" class="panel">
      <div class="title">Neon Arena</div>
      <div class="subtitle">
        WASD to move · Mouse to look<br/>
        Click in the game to lock and shoot.<br/>
        Survive endless waves of neon bots.
      </div>
      <button id="start-btn" class="btn">Start Game</button>
      <div style="margin-top:14px;font-size:12px;opacity:0.75;">
        After the overlay disappears,<br/>
        click once in the game area to lock your mouse.
      </div>
    </div>

    <div id="game-over-panel" class="panel">
      <div class="title">Game Over</div>
      <div class="subtitle">The arena got you this time. Ready for another run?</div>
      <div class="stat-row">
        <span>Final score</span>
        <span id="final-score-text">0</span>
      </div>
      <div class="stat-row">
        <span>Wave reached</span>
        <span id="final-wave-text">1</span>
      </div>
      <button id="restart-btn" class="btn">Play Again</button>
      <button id="quit-btn" class="btn btn-secondary">Back to Title</button>
    </div>
  </div>

  <!-- Three.js as ES module from CDN -->
  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.161.0/build/three.module.js";
    import { PointerLockControls } from "https://unpkg.com/three@0.161.0/examples/jsm/controls/PointerLockControls.js";

    let camera, scene, renderer, controls;
    const clock = new THREE.Clock();

    const bullets = [];
    const enemies = [];
    const powerUps = [];

    let moveForward = false;
    let moveBackward = false;
    let moveLeft = false;
    let moveRight = false;

    const velocity = new THREE.Vector3();
    const direction = new THREE.Vector3();

    let canShoot = true;
    let fireCooldown = 0.18;
    let fireTimer = 0;

    let playerSpeed = 16;
    const baseSpeed = 16;
    let rapidFireActive = false;
    let rapidFireTimer = 0;
    let speedBoostActive = false;
    let speedBoostTimer = 0;

    let health = 100;
    const maxHealth = 100;
    let score = 0;
    let wave = 1;
    let isPlaying = false;

    const enemyRadius = 1.2;
    const bulletSpeed = 80;

    const healthFillEl = document.getElementById("health-fill");
    const scoreTextEl = document.getElementById("score-text");
    const waveTextEl = document.getElementById("wave-text");
    const statusTextEl = document.getElementById("status-text");
    const overlayEl = document.getElementById("overlay");
    const startPanelEl = document.getElementById("start-panel");
    const gameOverPanelEl = document.getElementById("game-over-panel");
    const finalScoreEl = document.getElementById("final-score-text");
    const finalWaveEl = document.getElementById("final-wave-text");
    const startBtn = document.getElementById("start-btn");
    const restartBtn = document.getElementById("restart-btn");
    const quitBtn = document.getElementById("quit-btn");
    const powerupBanner = document.getElementById("powerup-banner");

    init();
    animate();

    function init() {
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.outputEncoding = THREE.sRGBEncoding;
      document.body.appendChild(renderer.domElement);

      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x020617);
      const fogColor = new THREE.Color(0x020617);
      scene.fog = new THREE.FogExp2(fogColor, 0.02);

      camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      camera.position.set(0, 1.6, 0);

      controls = new PointerLockControls(camera, renderer.domElement);

      controls.addEventListener("lock", () => {
        statusTextEl.textContent = "";
      });

      controls.addEventListener("unlock", () => {
        if (isPlaying) {
          statusTextEl.textContent = "Click in the game to lock cursor again";
        }
      });

      const hemiLight = new THREE.HemisphereLight(0x38bdf8, 0x0f172a, 1.0);
      scene.add(hemiLight);

      const dirLight = new THREE.DirectionalLight(0x38bdf8, 0.8);
      dirLight.position.set(5, 8, 5);
      scene.add(dirLight);

      const groundGeo = new THREE.PlaneGeometry(200, 200, 40, 40);
      const groundMat = new THREE.MeshBasicMaterial({
        color: 0x0b1120,
        wireframe: true
      });
      const ground = new THREE.Mesh(groundGeo, groundMat);
      ground.rotation.x = -Math.PI / 2;
      ground.position.y = 0;
      scene.add(ground);

      const pillarGeo = new THREE.BoxGeometry(1.2, 8, 1.2);
      const pillarMat1 = new THREE.MeshStandardMaterial({
        color: 0x22d3ee,
        emissive: 0x22d3ee,
        emissiveIntensity: 0.8,
        metalness: 0.2,
        roughness: 0.3
      });
      const pillarMat2 = new THREE.MeshStandardMaterial({
        color: 0xa855f7,
        emissive: 0xa855f7,
        emissiveIntensity: 0.8,
        metalness: 0.2,
        roughness: 0.3
      });
      for (let i = 0; i < 16; i++) {
        const mat = i % 2 === 0 ? pillarMat1 : pillarMat2;
        const p = new THREE.Mesh(pillarGeo, mat);
        const angle = (i / 16) * Math.PI * 2;
        const radius = 35;
        p.position.set(Math.cos(angle) * radius, 4, Math.sin(angle) * radius);
        scene.add(p);
      }

      spawnWave();

      document.addEventListener("keydown", onKeyDown);
      document.addEventListener("keyup", onKeyUp);
      window.addEventListener("resize", onWindowResize);

      renderer.domElement.addEventListener("mousedown", (event) => {
        if (!isPlaying) return;

        if (!controls.isLocked) {
          controls.lock();
          return;
        }

        if (event.button === 0) {
          shoot();
        }
      });

      startBtn.addEventListener("click", () => {
        startGame();
      });

      restartBtn.addEventListener("click", () => {
        startGame();
      });

      quitBtn.addEventListener("click", () => {
        isPlaying = false;
        showStartScreen();
      });

      updateHUD();
      statusTextEl.textContent = "";
    }

    function startGame() {
      resetGameState();
      overlayEl.style.display = "none";
      startPanelEl.style.display = "none";
      gameOverPanelEl.style.display = "none";
      isPlaying = true;
      statusTextEl.textContent = "Click in the game to lock cursor & shoot";
    }

    function showStartScreen() {
      overlayEl.style.display = "flex";
      startPanelEl.style.display = "block";
      gameOverPanelEl.style.display = "none";
      statusTextEl.textContent = "";
    }

    function showGameOver() {
      overlayEl.style.display = "flex";
      startPanelEl.style.display = "none";
      gameOverPanelEl.style.display = "block";
      finalScoreEl.textContent = score.toString();
      finalWaveEl.textContent = wave.toString();
      statusTextEl.textContent = "";
    }

    function resetGameState() {
      enemies.forEach(e => scene.remove(e.mesh));
      bullets.forEach(b => scene.remove(b.mesh));
      powerUps.forEach(p => scene.remove(p.mesh));
      enemies.length = 0;
      bullets.length = 0;
      powerUps.length = 0;

      health = maxHealth;
      score = 0;
      wave = 1;
      playerSpeed = baseSpeed;
      rapidFireActive = false;
      speedBoostActive = false;
      rapidFireTimer = 0;
      speedBoostTimer = 0;
      fireCooldown = 0.18;

      camera.position.set(0, 1.6, 0);
      velocity.set(0, 0, 0);
      spawnWave();
      updateHUD();
      hidePowerupBanner();
    }

    function onKeyDown(event) {
      switch (event.code) {
        case "ArrowUp":
        case "KeyW":
          moveForward = true;
          break;
        case "ArrowLeft":
        case "KeyA":
          moveLeft = true;
          break;
        case "ArrowDown":
        case "KeyS":
          moveBackward = true;
          break;
        case "ArrowRight":
        case "KeyD":
          moveRight = true;
          break;
        case "Space":
          event.preventDefault();
          break;
      }
    }

    function onKeyUp(event) {
      switch (event.code) {
        case "ArrowUp":
        case "KeyW":
          moveForward = false;
          break;
        case "ArrowLeft":
        case "KeyA":
          moveLeft = false;
          break;
        case "ArrowDown":
        case "KeyS":
          moveBackward = false;
          break;
        case "ArrowRight":
        case "KeyD":
          moveRight = false;
          break;
      }
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function spawnWave() {
      const count = 6 + wave * 2;
      for (let i = 0; i < count; i++) {
        spawnEnemy();
      }
      updateHUD();
      statusTextEl.textContent = "Wave " + wave + " – keep moving!";
    }

    function spawnEnemy() {
      const geo = new THREE.BoxGeometry(1.4, 1.4, 1.4);
      const colorOptions = [0x22d3ee, 0xf97316, 0xa855f7, 0x22c55e];
      const col = colorOptions[Math.floor(Math.random() * colorOptions.length)];
      const mat = new THREE.MeshStandardMaterial({
        color: col,
        emissive: col,
        emissiveIntensity: 0.8,
        metalness: 0.3,
        roughness: 0.4
      });

      const mesh = new THREE.Mesh(geo, mat);
      const angle = Math.random() * Math.PI * 2;
      const radius = 15 + Math.random() * 18;
      mesh.position.set(Math.cos(angle) * radius, 1.0, Math.sin(angle) * radius);
      mesh.userData.pulseOffset = Math.random() * Math.PI * 2;
      scene.add(mesh);

      enemies.push({
        mesh,
        speed: 4 + Math.random() * 2 + wave * 0.3
      });
    }

    function spawnPowerUp(position, type) {
      const geo = new THREE.SphereGeometry(0.5, 16, 16);
      let color;
      if (type === "health") color = 0xf97373;
      else if (type === "rapid") color = 0x38bdf8;
      else color = 0x22c55e;

      const mat = new THREE.MeshStandardMaterial({
        color,
        emissive: color,
        emissiveIntensity: 0.9,
        metalness: 0.1,
        roughness: 0.3
      });
      const mesh = new THREE.Mesh(geo, mat);
      mesh.position.copy(position);
      mesh.position.y = 1;
      scene.add(mesh);

      powerUps.push({ mesh, type, t: 0 });
    }

    function shoot() {
      if (!canShoot) return;

      const bulletGeo = new THREE.SphereGeometry(0.12, 12, 12);
      const bulletMat = new THREE.MeshBasicMaterial({ color: 0x22d3ee });
      const mesh = new THREE.Mesh(bulletGeo, bulletMat);

      const muzzle = new THREE.Vector3();
      camera.getWorldPosition(muzzle);
      const dir = new THREE.Vector3();
      camera.getWorldDirection(dir);
      muzzle.addScaledVector(dir, 0.8);
      mesh.position.copy(muzzle);
      scene.add(mesh);

      bullets.push({
        mesh,
        dir: dir.clone().normalize(),
        life: 1.5
      });

      canShoot = false;
      fireTimer = 0;
    }

    function applyDamage(amount) {
      health -= amount;
      if (health < 0) health = 0;
      updateHUD();
      if (health <= 0) {
        isPlaying = false;
        controls.unlock();
        showGameOver();
      }
    }

    function heal(amount) {
      health += amount;
      if (health > maxHealth) health = maxHealth;
      updateHUD();
      showPowerupBanner("+HP");
    }

    function boostRapidFire(duration) {
      rapidFireActive = true;
      rapidFireTimer = duration;
      fireCooldown = 0.06;
      showPowerupBanner("Rapid Fire");
    }

    function boostSpeed(duration) {
      speedBoostActive = true;
      speedBoostTimer = duration;
      playerSpeed = baseSpeed * 1.6;
      showPowerupBanner("Speed Boost");
    }

    function showPowerupBanner(text) {
      powerupBanner.textContent = text + " active";
      powerupBanner.classList.add("show");
      setTimeout(() => {
        powerupBanner.classList.remove("show");
      }, 1400);
    }

    function hidePowerupBanner() {
      powerupBanner.classList.remove("show");
    }

    function updateHUD() {
      const hpPercent = (health / maxHealth) * 100;
      healthFillEl.style.width = hpPercent + "%";
      scoreTextEl.textContent = score.toString();
      waveTextEl.textContent = wave.toString();
    }

    function updateMovement(delta) {
      if (!controls.isLocked || !isPlaying) return;

      velocity.x -= velocity.x * 10.0 * delta;
      velocity.z -= velocity.z * 10.0 * delta;

      direction.z = Number(moveForward) - Number(moveBackward);
      direction.x = Number(moveRight) - Number(moveLeft);
      direction.normalize();

      if (moveForward || moveBackward)
        velocity.z -= direction.z * playerSpeed * delta;
      if (moveLeft || moveRight)
        velocity.x -= direction.x * playerSpeed * delta;

      controls.moveRight(-velocity.x * delta);
      controls.moveForward(-velocity.z * delta);
    }

    function updateBullets(delta) {
      for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i];
        b.mesh.position.addScaledVector(b.dir, bulletSpeed * delta);
        b.life -= delta;
        b.mesh.scale.multiplyScalar(1 - delta * 1.5);

        if (b.life <= 0) {
          scene.remove(b.mesh);
          bullets.splice(i, 1);
          continue;
        }

        for (let j = enemies.length - 1; j >= 0; j--) {
          const e = enemies[j];
          const dist = b.mesh.position.distanceTo(e.mesh.position);
          if (dist < enemyRadius) {
            score += 10;
            updateHUD();

            e.mesh.scale.setScalar(1.8);
            e.mesh.material.emissiveIntensity = 1.5;
            scene.remove(e.mesh);
            enemies.splice(j, 1);

            scene.remove(b.mesh);
            bullets.splice(i, 1);

            const roll = Math.random();
            if (roll < 0.25) {
              const types = ["health", "rapid", "speed"];
              const type = types[Math.floor(Math.random() * types.length)];
              spawnPowerUp(e.mesh.position, type);
            }
            break;
          }
        }
      }
    }

    function updateEnemies(delta) {
      const playerPos = new THREE.Vector3();
      camera.getWorldPosition(playerPos);

      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];
        const mesh = e.mesh;

        const t = performance.now() * 0.001 + mesh.userData.pulseOffset;
        mesh.position.y = 1 + Math.sin(t * 3.0) * 0.12;
        mesh.rotation.y += delta * 1.2;

        const dir = new THREE.Vector3().subVectors(playerPos, mesh.position);
        const dist = dir.length();
        dir.normalize();
        mesh.position.addScaledVector(dir, e.speed * delta);

        if (dist < 1.2) {
          applyDamage(14 * delta);
        }
      }

      if (enemies.length === 0 && isPlaying) {
        wave++;
        spawnWave();
      }
    }

    function updatePowerUps(delta) {
      const playerPos = new THREE.Vector3();
      camera.getWorldPosition(playerPos);

      for (let i = powerUps.length - 1; i >= 0; i--) {
        const p = powerUps[i];
        p.t += delta;
        p.mesh.position.y = 1 + Math.sin(p.t * 4) * 0.3;
        p.mesh.rotation.y += delta * 1.4;

        const dist = p.mesh.position.distanceTo(playerPos);
        if (dist < 1.4) {
          if (p.type === "health") {
            heal(30);
          } else if (p.type === "rapid") {
            boostRapidFire(6);
          } else if (p.type === "speed") {
            boostSpeed(6);
          }
          scene.remove(p.mesh);
          powerUps.splice(i, 1);
        }
      }

      if (rapidFireActive) {
        rapidFireTimer -= delta;
        if (rapidFireTimer <= 0) {
          rapidFireActive = false;
          fireCooldown = 0.18;
        }
      }

      if (speedBoostActive) {
        speedBoostTimer -= delta;
        if (speedBoostTimer <= 0) {
          speedBoostActive = false;
          playerSpeed = baseSpeed;
        }
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      const delta = clock.getDelta();

      if (isPlaying) {
        updateMovement(delta);
        updateBullets(delta);
        updateEnemies(delta);
        updatePowerUps(delta);

        if (!canShoot) {
          fireTimer += delta;
          if (fireTimer >= fireCooldown) {
            canShoot = true;
            fireTimer = 0;
          }
        }
      }

      renderer.render(scene, camera);
    }
  </script>
</body>
</html>
